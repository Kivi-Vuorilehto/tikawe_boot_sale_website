{% extends "base.html" %}
{% block content %}

<form method="get" action="{{ url_for('index') }}" class="search-form">
    <input type="text" name="search" placeholder="Search by title..." value="{{ request.args.get('search', '') }}">

    <select name="sort">
        <option value="">Newest First</option>
        <option value="time_asc" {% if selected_sort == 'time_asc' %}selected{% endif %}>Oldest First</option>
        <option value="price_asc" {% if selected_sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
        <option value="price_desc" {% if selected_sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
    </select>

    <button type="submit">Search</button>
</form>

{% if listings %}
<div class="listings-container">
    {% for listing in listings %}
        <a href="{{ url_for('show_listing', listing_id=listing['listing_id']) }}" style="text-decoration: none; color: inherit;">
            <div class="listing-card">
                {% if listing['images'] and listing['images']|length > 0 %}
                    <img src="{{ url_for('static', filename='uploads/' ~ listing['images'][0]['image_url']) }}" 
                        alt="Listing image" class="listing-thumbnail">
                {% else %}
                    <div class="listing-thumbnail placeholder">No image</div>
                {% endif %}
                <h3>{{ listing['title'] }}</h3>
                <p><strong>Price:</strong> ${{ listing['price'] }}</p>
                <p><strong>Category:</strong> {{ listing['category'] }}</p>
                <p><strong>Location:</strong> {{ listing['location'] }}</p>
                <p><strong>Created:</strong> {{ listing['time_stamp'] }}</p>
            </div>
        </a>
    {% endfor %}
</div>
{% else %}
<p class="empty-message">No listings yet.</p>
{% endif %}

{% endblock %}